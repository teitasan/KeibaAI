
# モデル評価レポート

## 最終更新日時
2025-04-30 20:07:03

## 使用特徴量一覧

### 基本特徴量
- **オッズ関連**
  - `log_odds`: オッズの対数変換値
    - 変換方法: `np.log(data_df["オッズ"].values)`
    - 重要度: 1381

- **斤量関連**
  - `weight_scaled`: スケーリングされた斤量
    - 変換方法: `(data_df["斤量"].values - 48) * 2`
    - 重要度: 529

### レース間隔関連特徴量
- **interval_category**: レース間隔のカテゴリ分類
  - カテゴリ:
    1. `デビュー`: 初出走
    2. `連闘`: 0-8日
    3. `中1週`: 8-15日
    4. `中2-4週`: 15-35日
    5. `1-3ヶ月`: 35-91日
    6. `3-6ヶ月`: 91-182日
    7. `6ヶ月-1年`: 182-365日
    8. `1年以上`: 365日超
  - 重要度: 263

- **is_debut**: デビュー戦フラグ
  - 値: `0` または `1`
  - 計算方法: `last_race_date.isna().astype(int)`
  - 重要度: 68

### 馬場適性関連特徴量
- **diff_rank_bad_vs_overall**: 道悪（重・不良）と全体での平均着順の差
  - 値: 数値（負の値=道悪得意、正の値=道悪苦手）
  - 計算方法: `道悪での平均着順 - 全体での平均着順`
  - 重要度: 546

- **has_bad_track_exp**: 道悪経験フラグ
  - 値: `0`（経験少）または `1`（2回以上の出走経験あり）
  - 計算方法: `道悪での出走回数 >= 2`
  - 重要度: 101

- **track_condition**: 現在のレースの馬場状態
  - 値: `良`、`稍`、`重`、`不`
  - データソース: 元データの`馬場`カラム
  - 重要度: 112

### 時系列関連
- **days_since_last_race**: 前走からの経過日数
  - 計算方法: `(df["日付"] - df["last_race_date"]).dt.days`
  - 注意: デビュー戦の場合はNaN

### 目的変数
- **3着以内フラグ**
  - 計算方法: `(着順 <= 3).astype(int)`
  - 値: `0`（3着より下）または `1`（3着以内）

## 特徴量の重要度ランキング
- log(オッズ): 1381
- 道悪適性差: 546
- 斤量: 529
- interval_category: 263
- 馬場状態: 112
- 道悪経験フラグ: 101
- デビュー戦フラグ: 68

## モデル評価指標

### 全体評価指標
- accuracy: 0.745
- precision: 0.452
- recall: 0.723
- f1_score: 0.556
- best_threshold: 0.250

### レース単位評価指標
- Precision@3: 各レースで上位3頭予測に含まれた実際の3着以内馬の割合（平均）
  - 値: 0.530
- Recall@3: 各レースで実際の3着以内馬のうち、上位3頭予測に含まれた割合（平均）
  - 値: 0.530
- Hit Rate@3: 上位3頭予測に1頭でも3着以内馬が含まれていたレースの割合
  - 値: 0.935
- NDCG@3: 予測順位の質を評価する指標（1.0が最高値）
  - 値: 0.559
  - 説明: 上位3頭の予測順位が実際の3着以内馬の順位にどれだけ近いかを評価
  - 計算方法: DCG（予測順位の利得）をIDCG（理想的な順位の利得）で正規化

## 評価履歴
# モデル評価履歴

## 20250429_184831

### 評価指標
- accuracy: 0.747
- precision: 0.455
- recall: 0.716
- f1_score: 0.556
- best_threshold: 0.250

### 特徴量の重要度
- log(オッズ): 1635
- 斤量: 670
- interval_category: 313
- デビュー戦フラグ: 52

---

## 20250429_190040

### 評価指標
- accuracy: 0.747
- precision: 0.455
- recall: 0.716
- f1_score: 0.556
- best_threshold: 0.250
- precision_at_3: 0.531
- recall_at_3: 0.531
- hit_rate_at_3: 0.937

### 特徴量の重要度
- log(オッズ): 1635
- 斤量: 670
- interval_category: 313
- デビュー戦フラグ: 52

---

## 20250429_190640

### 評価指標
- accuracy: 0.747
- precision: 0.455
- recall: 0.716
- f1_score: 0.556
- best_threshold: 0.250
- precision_at_3: 0.531
- recall_at_3: 0.531
- hit_rate_at_3: 0.937
- ndcg_at_3: 0.560

### 特徴量の重要度
- log(オッズ): 1635
- 斤量: 670
- interval_category: 313
- デビュー戦フラグ: 52

---

## 20250430_183012

### 評価指標
- accuracy: 0.748
- precision: 0.455
- recall: 0.719
- f1_score: 0.557
- best_threshold: 0.250
- precision_at_3: 0.531
- recall_at_3: 0.531
- hit_rate_at_3: 0.936
- ndcg_at_3: 0.560

### 特徴量の重要度
- log(オッズ): 1309
- 道悪適性差: 936
- 斤量: 422
- interval_category: 233
- 道悪経験フラグ: 78
- デビュー戦フラグ: 22

---

## 20250430_185225

### 評価指標
- accuracy: 0.746
- precision: 0.454
- recall: 0.722
- f1_score: 0.557
- best_threshold: 0.250
- precision_at_3: 0.530
- recall_at_3: 0.530
- hit_rate_at_3: 0.936
- ndcg_at_3: 0.559

### 特徴量の重要度
- log(オッズ): 1174
- 道悪適性差: 726
- 斤量: 396
- interval_category: 210
- 馬場状態: 75
- 道悪経験フラグ: 58
- デビュー戦フラグ: 31

---

## 20250430_193659

### 評価指標
- accuracy: 0.746
- precision: 0.454
- recall: 0.722
- f1_score: 0.557
- best_threshold: 0.250
- precision_at_3: 0.530
- recall_at_3: 0.530
- hit_rate_at_3: 0.936
- ndcg_at_3: 0.559

### 特徴量の重要度
- log(オッズ): 1174
- 道悪適性差: 726
- 斤量: 396
- interval_category: 210
- 馬場状態: 75
- 道悪経験フラグ: 58
- デビュー戦フラグ: 31

---

## 20250430_200703

### 評価指標
- accuracy: 0.745
- precision: 0.452
- recall: 0.723
- f1_score: 0.556
- best_threshold: 0.250
- precision_at_3: 0.530
- recall_at_3: 0.530
- hit_rate_at_3: 0.935
- ndcg_at_3: 0.559

### 特徴量の重要度
- log(オッズ): 1381
- 道悪適性差: 546
- 斤量: 529
- interval_category: 263
- 馬場状態: 112
- 道悪経験フラグ: 101
- デビュー戦フラグ: 68

---

